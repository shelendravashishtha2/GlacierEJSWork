<%- contentFor('HeaderCss') %>
<style type="text/css">
.image_container {
    height: 120px;
    width: 200px;
    border-radius: 6px;
    overflow: hidden;
    margin: 10px;
}
.image_container img {
    height: 100%;
    width: 100%;
    /* object-fit: cover; */
}
.image_container span {
    top: -6px;
    right: 8px;
    color: red;
    font-size: 28px;
    font-weight: normal;
    cursor: pointer;
}
</style>
<%- contentFor('breadcrumb') %>
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0 font-size-18">Edit Property & Wing</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="/properties">Properties</a></li>
                    <li class="breadcrumb-item active">Edit Property & Wing</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- end page title -->
<%- contentFor('body') %>
<div class="row">
    <div class="col-xl-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Edit Property</h4>
                <form action="/admin/api/property-update" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="_id" value="<%= data[0]._id %>">
                    <div class="row">
                        <div class="col-xl-6">
                            <div class="mb-3">
                                <label class="form-label">Property Name<span class="required">*</span></label>
                                <input type="text" name="property_name" class="form-control" id="defaultconfig" value="<%= data[0].property_name %>" placeholder="Enter Property Name" autofocus maxlength="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address<span class="required">*</span></label>
                                <textarea id="textarea" name="address" class="form-control" maxlength="225" rows="3" placeholder="This textarea has a limit of 225 chars."><%= data[0].address %></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Select Location<span class="required">*</span></label>
                                <input type="text" name="location" class="form-control" id="address" value="<%= data[0].location %>" placeholder="Enter Location" maxlength="50">
                                <input type="hidden" name="latitude" id="lat" value="<%= data[0].location[0] %>" required>
                                <input type="hidden" name="longitude" id="lng" value="<%= data[0].location[1] %>" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Upload Img</label>
                                <input type="file" name="property_images" id="image" multiple="" class="form-control" onchange="image_select()">
                            </div>
                            <div>Slider Image Preview : </div>
                            <div class="card-body d-flex flex-wrap justify-content-start" id="container">
                                    <!-- Image will be show here-->    	  
                            </div>

                            <!-- BEGIN OTHER INFORMATION FORM  -->
                            <h4 class="card-title">Other Information</h4>
                            <div class="mb-3">
                                <label class="form-label">Name of Owner<span class="required">*</span></label>
                                <input type="text" name="name_of_owner" class="form-control" id="defaultconfig" value="<%= data[0].name_of_owner %>" placeholder="Enter Name of Owner" autofocus maxlength="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Area Name<span class="required">*</span></label>
                                <textarea id="textarea" name="area_name" class="form-control" maxlength="225" rows="3" placeholder="This textarea has a limit of 225 chars."><%= data[0].area_name %></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Squere Feet<span class="required">*</span></label>
                                <input type="text" name="square_feet" class="form-control" id="default" value="<%= data[0].square_feet %>" placeholder="Enter Squere Feet" maxlength="100">
                            </div>
                            <!-- END OTHER INFORMATION FORM  -->
                        </div>

                        <div class="col-xl-6">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Add | Remove Wing <a href="javascript:void(0);" class="add_button btn btn-warning" style="float: right;" title="Add field">Add New Wings</a></h4>
                                    <label>Wing Name :</label>
                                    <div class="mb-3 row">
                                        <div class="col-md-11 col-8">
                                            <div class="input_field_wrapper">
                                                <% for (j = 0; j < data[0].wings.length; j++) { %>
                                                    <div style="display:flex;"  id="inputFormRow">
                                                    <input type="text" class="form-control" name="wings" value="<%=data[0].wings[j]%>" placeholder="Enter Wing Name" style="margin-bottom: 15px;margin-right:15px;" />
                                                    <button class="remove_button btn btn-danger" id="removeRow" type="button" class="btn btn-danger" style="margin-bottom: 14px;">-</button>
                                                    </div>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Old Slider Images</h4>
                                    <div class="row">
                                        <% for (j = 0; j < data[0].property_images.length; j++) { %>
                                        <div class="col-md-3">
                                            <img class="d-block img-fluid" src="<%=process.env.PUBLIC_URL+data[0].property_images[j]%>" alt="Property first image" style="height: 100px;
                                            width: 100%;padding:5px;">
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-bottom:20px;">
                        <div class="col-xl-2"></div>
                        <div class="col-xl-6">
                            <button type="submit" class="btn btn-warning waves-effect waves-light"><i class="bx bx-check-double label-icon"></i> Update</button>
                            <a href="/properties"><button type="button" class="btn btn-danger waves-effect waves-light"><i class="bx bx-block label-icon"></i> Cancel</button></a>
                        </div>  
                    </div>
                    <p> <span class="required">*</span> Represent that it's compulsory fields </p>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- end row -->
<%- contentFor('FooterJs') %>
<!-- Add Property & Wing init -->
<script src="<%=process.env.PUBLIC_URL%>/public/assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
<script src="<%=process.env.PUBLIC_URL%>/public/assets/libs/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
<script src="<%=process.env.PUBLIC_URL%>/public/assets/libs/parsleyjs/parsley.min.js"></script>
<script src="<%=process.env.PUBLIC_URL%>/public/assets/js/pages/form-validation.init.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=&libraries=places"></script>
<script>
    $(document).ready(function(){
        var input = document.getElementById('address');
        var autocomplete = new google.maps.places.Autocomplete(input, {});
        autocomplete.addListener('place_changed', function () {
            var place = autocomplete.getPlace();
            //document.getElementById('address').value = place.geometry.location;
            document.getElementById('lat').value=place.geometry.location.lat();
            document.getElementById('lng').value=place.geometry.location.lng();

        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function(){
        var maxFieldLimit = 30; //Input fields increment limitation
        var add_more_button = $('.add_button'); //Add button selector
        var Fieldwrapper = $('.input_field_wrapper'); //Input field wrapper
        var fieldHTML = '<div style="display:flex;margin-bottom:10px;"><input type="text" name="wings" class="form-control" value="" placeholder="Enter Wing Name"/><a href="javascript:void(0);" class="remove_button btn btn-danger" style="margin-left:10px;">-</a></div>'; //New input field html 
        var x = 1; //Initial field counter is 1
        $(add_more_button).click(function(){ //Once add button is clicked
            if(x < maxFieldLimit){ //Check maximum number of input fields
                x++; //Increment field counter
                $(Fieldwrapper).append(fieldHTML); // Add field html
            }
        });
        $(Fieldwrapper).on('click', '.remove_button', function(e){ //Once remove button is clicked
            e.preventDefault();
            $(this).parent('div').remove(); //Remove field html
            x--; //Decrement field counter
        });

        // remove row
        $(document).on('click', '#removeRow', function () {
            $(this).closest('#inputFormRow').remove();
        });
    });
</script>
<script>
    // this variable will store images for preview
    var images = [];
   
   // this function will select images
   function image_select() {
        var image = document.getElementById('image').files;
        for (i = 0; i < image.length; i++) {
            if (check_duplicate(image[i].name)) {
            images.push({
                "name" : image[i].name,
                "url" : URL.createObjectURL(image[i]),
                "file" : image[i],
            })
            } else 
            {
                alert(image[i].name + " is already added to the list");
            }
        }
        document.getElementById('container').innerHTML = image_show();
    }
   
   // this function will show images in the DOM
   function image_show() {
        var image = "";
        images.forEach((i) => {
            image += `<div class="image_container d-flex justify-content-center position-relative">
                <img src="`+ i.url +`" alt="Image">
                <span class="position-absolute" onclick="delete_image(`+ images.indexOf(i) +`)">&times;</span>
            </div>`;
        })
        return image;
    }
   
   // this function will get all images from the array
    function get_image_data() {
        var form = new FormData()
        for (let index = 0; index < images.length; index++) {
            form.append("file[" + index + "]", images[index]['file']);
        }
        return form;
    }
   
   // this function will delete a specific image from the container
   function delete_image(e) {
        images.splice(e, 1);
        document.getElementById('container').innerHTML = image_show();
   	}
   
   // this function will check duplicate images
   function check_duplicate(name) {
    var image = true;
    if (images.length > 0) {
        for (e = 0; e < images.length; e++) {
            if (images[e].name == name) {
                image = false;
                break;
            }
        }
    }
    return image;
    }
</script>
<%- contentFor('BottomJs') %>